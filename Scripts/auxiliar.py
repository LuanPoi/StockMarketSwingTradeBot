import pandas as pd
import numpy as np
import pandas_datareader as pdr
import yfinance as yf



# **********************************************************************************************************************************************************************************************
# *                              Tópico - Informações iniciais                                           *
# **********************************************************************************************************************************************************************************************
print(
        "Configuracoes:\n"
        + "pdr: " + pdr.__version__ + "\n"
        + "pandas: " + pd.__version__ + "\n"
        + "numpy: " + np.__version__ + "\n"
        + "yfinance: " + yf.__version__ + "\n"
        #+ ": " +  + "\n"
)




# **********************************************************************************************************************************************************************************************
# *                              Tópico - Inicializações                                                *
# **********************************************************************************************************************************************************************************************
tickers = {
        "Inter": "BIDI4.SA",
        "Petrobras": "PETR4.SA",
        "Vale": "VALE3.SA",
        "Itau": "ITUB4.SA",
        "Ambev": "ABEV3.SA",
        "Sinqia": "SQIA3.SA",
        "Bovespa": "BOVA11.SA"
}




# **********************************************************************************************************************************************************************************************
# *                              Tópico - Aquisição                                                     *
# **********************************************************************************************************************************************************************************************
yf.pdr_override()
historico: pd.DataFrame = pdr.data.get_data_yahoo(tickers['Petrobras'], period="max")




# **********************************************************************************************************************************************************************************************
# *                              Tópico - Data Cleansing                                                *
# **********************************************************************************************************************************************************************************************
# TODO: Remover linhas até achar a primeira segunda feira
historico.replace([0, np.inf, -np.inf, "", None], np.nan, inplace=True)
historico.iloc[3:8,4] = np.nan

for i in range(historico.shape[0]):
        linha = historico.iloc[i]
        for coluna in range(len(linha.index)):
                if str(linha[coluna]) == str(np.nan):
                        a_frente = 0
                        valor = historico.iloc[i-1, coluna]
                        while True:
                                if (i == 0):
                                        a_frente = a_frente + 1
                                        if str(historico.iloc[i + a_frente, coluna]) != str(np.nan):
                                                valor = historico.iloc[i + a_frente, coluna]
                                                for x in range(a_frente):
                                                        historico.iloc[i + x, coluna] = valor
                                                a_frente = 0
                                                valor = 0
                                                break
                                elif (i + a_frente + 1) == historico.shape[0]:
                                        for x in range(a_frente):
                                                historico.iloc[i + x, coluna] = historico.iloc[i-1, coluna]
                                        a_frente = 0
                                        valor = 0
                                        break
                                else:
                                        a_frente = a_frente + 1
                                        if str(historico.iloc[i + a_frente, coluna]) != str(np.nan):
                                                valor = (historico.iloc[i + a_frente, coluna] - valor) / (1 + a_frente)
                                                for x in range(a_frente):
                                                        historico.iloc[i + x, coluna] = ((1 + x) * valor) + historico.iloc[i-1, coluna]
                                                a_frente = 0
                                                valor = 0
                                                break



# **********************************************************************************************************************************************************************************************
# *                              Tópico -                                                *
# **********************************************************************************************************************************************************************************************




# **********************************************************************************************************************************************************************************************
# *                              Tópico -                                                *
# **********************************************************************************************************************************************************************************************




# **********************************************************************************************************************************************************************************************
# *                              Tópico -                                                *
# **********************************************************************************************************************************************************************************************




# **********************************************************************************************************************************************************************************************
# *                              Tópico -                                                *
# **********************************************************************************************************************************************************************************************




# **********************************************************************************************************************************************************************************************
# *                              Tópico -                                                *
# **********************************************************************************************************************************************************************************************



print('\nfim')